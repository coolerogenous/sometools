<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1920x1080 Audio Player</title>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #333; /* èƒŒæ™¯æ”¹æ·±è‰²ä¸€ç‚¹ï¼Œè¡¬æ‰˜æ’­æ”¾å™¨ */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        .player-container {
            /* è®¾å®šä¸º 1920 x 1080 */
            width: 1920px;
            height: 1080px;
            background-color: #000000;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            /* å†…è¾¹è·æ”¾å¤§ 3 å€ */
            padding: 60px; 
            box-sizing: border-box;
        }

        .header {
            margin-bottom: 30px; /* é—´è·æ”¾å¤§ */
            text-align: center;
        }

        .title {
            font-size: 54px; /* 18px * 3 */
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 24px; /* 12px * 3 */
            color: #a0a0a0;
        }

        .lyrics-container {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 40px;
            /* ä½ çš„è¦æ±‚ï¼šå¤§å­—ä½“ */
            font-size: 110px; 
            line-height: 1.4;
            color: #ffffff;
            overflow: hidden;
            white-space: pre-wrap;
            font-family: "Courier New", Courier, monospace;
            font-weight: bold;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 30px; /* é—´è·æ”¾å¤§ */
            margin-bottom: 20px;
        }

        .progress-bar-container {
            display: flex;
            align-items: center;
            font-size: 36px; /* æ—¶é—´å­—ä½“æ”¾å¤§ */
            color: #888;
            font-variant-numeric: tabular-nums;
        }

        .time {
            min-width: 110px; /* é¢„ç•™æ›´å®½çš„ç©ºé—´ */
        }

        .time-left {
            text-align: right;
        }

        .progress-bar {
            flex-grow: 1;
            height: 12px; /* è¿›åº¦æ¡å˜ç²— */
            background-color: #e0e0e0;
            border-radius: 6px;
            margin: 0 30px;
            position: relative;
            cursor: pointer;
        }

        .progress {
            height: 100%;
            background-color: #ff75d6;
            border-radius: 6px;
            width: 0%;
        }

        .buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 60px; /* æŒ‰é’®åŒºåŸŸå†…è¾¹è· */
        }

        .btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ff75d6;
        }

        .btn-center {
            color: #ffffff;
        }

        /* å›¾æ ‡ç»Ÿä¸€æ”¾å¤§ */
        .btn-icon {
            width: 72px;  /* 24px * 3 */
            height: 72px;
            fill: currentColor;
        }

        .btn-play .btn-icon {
            width: 100px; /* æ’­æ”¾é”®æ›´å¤§ä¸€ç‚¹ */
            height: 100px;
        }

        .btn-skip {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .btn-skip span {
            font-size: 24px; /* è·³è¿‡ç§’æ•°çš„æ–‡å­—æ”¾å¤§ */
            margin-top: -10px;
            font-weight: bold;
        }

        /* éšè—æ–‡ä»¶è¾“å…¥æ¡† */
        #srtFileInput {
            display: none;
        }
    </style>
</head>
<body>

<div class="player-container">
    <div class="header">
        <div class="title">å¿½ç„¶ä¹‹é—´</div>
        <div class="subtitle" id="statusInfo">ç­‰å¾…åŠ è½½...</div>
    </div>

    <div class="lyrics-container" id="lyrics">
        <!-- {\__/}
        ( â€¢ - â€¢)
        /ã¤ğŸ“åäºŒæ¥¼ -->
    </div>

    <div class="controls">
        <div class="progress-bar-container">
            <div class="time" id="currentTime">0:00</div>
            <div class="progress-bar" id="progressBar">
                <div class="progress" id="progress"></div>
            </div>
            <div class="time time-left" id="timeLeft">-0:00</div>
        </div>
        <div class="buttons">
            <button class="btn" id="importBtn" title="é‡æ–°åŠ è½½">
                <svg class="btn-icon" viewBox="0 0 24 24">
                    <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
                </svg>
            </button>
            <button class="btn btn-center btn-skip" id="rewindBtn">
                <svg class="btn-icon" viewBox="0 0 24 24"><path d="M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z"/></svg>
                <span>15</span>
            </button>
            <button class="btn btn-center btn-play" id="playBtn">
                <svg class="btn-icon" id="playIcon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                <svg class="btn-icon" id="pauseIcon" viewBox="0 0 24 24" style="display: none;"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
            </button>
            <button class="btn btn-center btn-skip" id="forwardBtn">
                <svg class="btn-icon" viewBox="0 0 24 24"><path d="M4 18l8.5-6L4 6v12zm9-12v12l8.5-6L13 6z"/></svg>
                <span>15</span>
            </button>
            <button class="btn">
                <svg class="btn-icon" viewBox="0 0 24 24">
                    <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                </svg>
            </button>
        </div>
    </div>
</div>

<script>
    // ==========================================
    // è¯·åœ¨æ­¤å¤„ä¿®æ”¹ä½ çš„ SRT æ–‡ä»¶è·¯å¾„
    const srtFilePath = 'huranzhijian.srt'; 
    // ==========================================

    let state = {
        isPlaying: false,
        currentTime: 0,
        duration: 0, 
        lastFrameTime: 0
    };
    let lyrics = [];
    let animationFrameId;

    const playBtn = document.getElementById('playBtn');
    const playIcon = document.getElementById('playIcon');
    const pauseIcon = document.getElementById('pauseIcon');
    const rewindBtn = document.getElementById('rewindBtn');
    const forwardBtn = document.getElementById('forwardBtn');
    const progressBar = document.getElementById('progressBar');
    const progress = document.getElementById('progress');
    const currentTimeEl = document.getElementById('currentTime');
    const timeLeftEl = document.getElementById('timeLeft');
    const lyricsEl = document.getElementById('lyrics');
    const importBtn = document.getElementById('importBtn');
    const statusInfo = document.getElementById('statusInfo');

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è·å–æ–‡ä»¶
    loadCustomSrt();

    importBtn.addEventListener('click', loadCustomSrt);

    function loadCustomSrt() {
        fetch(srtFilePath)
            .then(response => {
                if (!response.ok) throw new Error("æ–‡ä»¶æœªæ‰¾åˆ°");
                return response.text();
            })
            .then(data => {
                lyrics = parseSRT(data);
                if (lyrics.length > 0) {
                    state.duration = lyrics[lyrics.length - 1].end + 2;
                    statusInfo.textContent = "sourvill";
                    // é»˜è®¤æ˜¾ç¤ºå°é¢é¢œæ–‡å­—
                    lyricsEl.innerHTML = "Loading..."
//                     lyricsEl.innerHTML = `{\\__/}
// ( â€¢ - â€¢)
// /ã¤ğŸ“åäºŒæ¥¼`;
                    updateUI();
                }
            })
            .catch(error => {
                console.error(error);
                lyricsEl.innerHTML = "è¯»å–å¤±è´¥: " + srtFilePath + "<br><small>è¯·ç¡®ä¿ä½¿ç”¨æœåŠ¡å™¨è¿è¡Œ (Live Server)</small>";
            });
    }

    function parseSRT(data) {
        const normalizedData = data.replace(/\r\n/g, '\n');
        const lines = normalizedData.trim().split('\n\n');
        
        return lines.map(line => {
            const parts = line.split('\n');
            let timeLineIndex = parts.findIndex(p => p.includes('-->'));
            if (timeLineIndex === -1) return null;

            const timeLine = parts[timeLineIndex];
            const textLines = parts.slice(timeLineIndex + 1);

            const time = timeLine.split(' --> ');
            if (time.length < 2) return null;

            return {
                start: timeToSeconds(time[0]),
                end: timeToSeconds(time[1]),
                text: textLines.join('<br>')
            };
        }).filter(item => item !== null);
    }

    function timeToSeconds(timeString) {
        const [hours, minutes, seconds] = timeString.split(':');
        const [sec, ms] = seconds.split(',');
        return parseInt(hours) * 3600 + parseInt(minutes) * 60 + parseInt(sec) + parseInt(ms || 0) / 1000;
    }

    function formatTime(seconds) {
        if (isNaN(seconds)) return "0:00";
        seconds = Math.max(0, seconds);
        const min = Math.floor(seconds / 60);
        const sec = Math.floor(seconds % 60);
        return `${min}:${sec < 10 ? '0' : ''}${sec}`;
    }

    function togglePlay() {
        if (state.duration === 0) return;

        if (state.isPlaying) {
            state.isPlaying = false;
            cancelAnimationFrame(animationFrameId);
            playIcon.style.display = 'block';
            pauseIcon.style.display = 'none';
        } else {
            state.isPlaying = true;
            state.lastFrameTime = performance.now();
            playIcon.style.display = 'none';
            pauseIcon.style.display = 'block';
            gameLoop();
        }
    }

    function gameLoop() {
        if (!state.isPlaying) return;

        const now = performance.now();
        const deltaTime = (now - state.lastFrameTime) / 1000;
        state.lastFrameTime = now;

        state.currentTime += deltaTime;

        if (state.currentTime >= state.duration) {
            state.currentTime = state.duration;
            togglePlay(); 
        }

        updateUI();
        animationFrameId = requestAnimationFrame(gameLoop);
    }

    function updateLyrics() {
        if (lyrics.length === 0) return;
        const currentLyric = lyrics.find(lyric => state.currentTime >= lyric.start && state.currentTime <= lyric.end);
        
        if (currentLyric) {
            lyricsEl.innerHTML = currentLyric.text;
        } 
    }

    function updateUI() {
        const percent = (state.currentTime / state.duration) * 100 || 0;
        progress.style.width = `${percent}%`;
        
        currentTimeEl.textContent = formatTime(state.currentTime);
        timeLeftEl.textContent = `-${formatTime(state.duration - state.currentTime)}`;
        
        updateLyrics();
    }

    playBtn.addEventListener('click', togglePlay);
    
    rewindBtn.addEventListener('click', () => {
        state.currentTime = Math.max(0, state.currentTime - 15);
        updateUI();
    });
    
    forwardBtn.addEventListener('click', () => {
        state.currentTime = Math.min(state.duration, state.currentTime + 15);
        updateUI();
    });

    progressBar.addEventListener('click', (e) => {
        if (state.duration === 0) return;
        const clickX = e.offsetX;
        const width = progressBar.clientWidth;
        state.currentTime = (clickX / width) * state.duration;
        updateUI();
    });

</script>

</body>
</html>