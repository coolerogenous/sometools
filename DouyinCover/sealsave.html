<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒå±è‡ªé€‚åº”å°é¢ (å¸¦æ•°å€¼æ˜¾ç¤º)</title>
    <style>
        body {
            margin: 0;
            background-color: #121212;
            color: #eee;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* --- å·¦ä¾§æ§åˆ¶æ  --- */
        .sidebar {
            width: 340px;
            background-color: #1e1e1e;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            border-right: 1px solid #333;
            overflow-y: auto;
            flex-shrink: 0;
        }

        .sidebar::-webkit-scrollbar { width: 5px; }
        .sidebar::-webkit-scrollbar-thumb { background: #444; border-radius: 2px; }

        h2 { margin: 10px 0 5px 0; font-size: 13px; color: #888; letter-spacing: 1px; font-weight: 600; text-transform: uppercase; }
        
        .control-group { display: flex; flex-direction: column; gap: 5px; }
        .row { display: flex; gap: 8px; align-items: center; }
        
        label { font-size: 12px; color: #aaa; display: flex; justify-content: space-between; align-items: center; }
        
        /* æ•°å€¼æ˜¾ç¤ºçš„é«˜äº®æ ·å¼ */
        .value-display { color: #007aff; font-weight: bold; font-family: monospace; }
        .value-default { color: #34c759; font-weight: bold; } /* é»˜è®¤å€¼æ—¶çš„é¢œè‰² */

        input, textarea, button {
            background: #2c2c2c;
            border: 1px solid #3d3d3d;
            color: white;
            padding: 8px;
            border-radius: 4px;
            font-size: 13px;
            box-sizing: border-box;
            width: 100%;
        }

        input:focus, textarea:focus { border-color: #007aff; outline: none; }
        textarea { resize: vertical; min-height: 60px; font-family: inherit; }

        /* æ¯”ä¾‹è¾“å…¥æ¡† */
        .ratio-input { text-align: center; font-weight: bold; font-size: 16px; color: #007aff; }
        .ratio-divider { color: #888; font-weight: bold; }

        .btn-save {
            background-color: #34c759; border: none; font-weight: bold; 
            padding: 10px; cursor: pointer; margin-top: 5px;
        }
        .btn-save:hover { background-color: #2da84a; }

        /* --- å³ä¾§é¢„è§ˆåŒº --- */
        .preview-area {
            flex-grow: 1;
            background-color: #000;
            display: flex;
            gap: 20px;
            padding: 40px;
            overflow: auto;
            justify-content: center;
            align-items: center;
            background-image: radial-gradient(#333 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .canvas-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .canvas-label {
            font-size: 12px; color: #666; background: #222; 
            padding: 4px 8px; border-radius: 4px; border: 1px solid #333;
        }

        canvas {
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            max-height: 80vh; 
            max-width: 45vw;
            background: #fff;
            object-fit: contain;
        }
    </style>
</head>
<body>

    <div class="sidebar">
        <h1 style="font-size: 16px; margin: 0 0 10px 0; color: #fff;">ğŸ›ï¸ åŒå±è‡ªé€‚åº”ç”Ÿæˆ</h1>

        <h2>1. æ¯”ä¾‹è®¾ç½®</h2>
        <div class="control-group">
            <label>å®½é«˜æ¯” (è‡ªåŠ¨ç”Ÿæˆæ¨ª/ç«–ä¸¤ç‰ˆ)</label>
            <div class="row">
                <input type="number" id="ratioW" class="ratio-input" value="16">
                <span class="ratio-divider">:</span>
                <input type="number" id="ratioH" class="ratio-input" value="9">
            </div>
            <label style="margin-top:5px;">åŸºç¡€æ¸…æ™°åº¦ (åŸºå‡†é«˜åº¦ px)</label>
            <input type="number" id="baseRes" value="1080">
        </div>

        <h2>2. æ­Œæ›²ä¿¡æ¯</h2>
        <div class="control-group">
            <label>æ­Œå</label>
            <input type="text" id="songTitle" value="åäºŒæ¥¼">
        </div>
        <div class="control-group">
            <label>æ­Œæ‰‹</label>
            <input type="text" id="artistName" value="Sourvill">
        </div>

        <h2>3. æ­Œè¯å†…å®¹</h2>
        <div class="control-group">
            <label>æ­Œè¯ (æ”¯æŒæ¢è¡Œï¼Œè‡ªåŠ¨å±…ä¸­)</label>
            <textarea id="lyricsText">{\__/}
( â€¢ - â€¢)
/ã¤ ğŸ“
åäºŒæ¥¼</textarea>
        </div>
        
        <div class="row">
            <div class="control-group" style="flex:1">
                <label>
                    å­—ä½“ç¼©æ”¾ 
                    <span id="scaleValueText" class="value-default">1.0 (é»˜è®¤)</span>
                </label>
                <input type="range" id="scaleFactor" min="0.5" max="2.0" step="0.1" value="1.0" list="scaleList">
                <datalist id="scaleList">
                    <option value="1.0" label="é»˜è®¤"></option>
                </datalist>
            </div>
        </div>

        <h2>4. æ’­æ”¾å™¨çŠ¶æ€</h2>
        <div class="row">
            <div class="control-group" style="flex:1">
                <label>å½“å‰æ—¶é—´</label>
                <input type="text" id="timeCurr" value="3:00">
            </div>
            <div class="control-group" style="flex:1">
                <label>å‰©ä½™æ—¶é—´</label>
                <input type="text" id="timeLeft" value="-1:04">
            </div>
        </div>
        <div class="control-group">
            <label>è¿›åº¦æ¡ (0-1)</label>
            <input type="range" id="progressVal" min="0" max="1" step="0.01" value="0.72">
        </div>

        <h2>5. èƒŒæ™¯ä¸é®ç½©</h2>
        <div class="control-group">
            <label>ä¸Šä¼ èƒŒæ™¯å›¾</label>
            <input type="file" id="bgInput" accept="image/*">
        </div>
        <div class="control-group">
            <label>é®ç½©æµ“åº¦ (0-1)</label>
            <input type="range" id="overlayVal" min="0" max="0.9" step="0.05" value="0.1">
        </div>

        <div class="row" style="margin-top: 10px;">
            <button class="btn-save" style="background:#007aff" onclick="downloadImage('h')">ğŸ’¾ ä¸‹æ¨ªå±</button>
            <button class="btn-save" onclick="downloadImage('v')">ğŸ’¾ ä¸‹ç«–å±</button>
        </div>
    </div>

    <div class="preview-area">
        <div class="canvas-group">
            <span class="canvas-label">æ¨ªå± (Horizontal)</span>
            <canvas id="canvasH"></canvas>
        </div>
        
        <div class="canvas-group">
            <span class="canvas-label">ç«–å± (Vertical)</span>
            <canvas id="canvasV"></canvas>
        </div>
    </div>

<script>
    const ICONS = {
        play: "M8 5v14l11-7z", 
        pause: "M6 19h4V5H6v14zm8-14v14h4V5h-4z",
        arrowLeft: "M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z",
        arrowRight: "M4 18l8.5-6L4 6v12zm9-12v12l8.5-6L13 6z",
        volume: "M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z",
        trash: "M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"
    };

    const cvH = document.getElementById('canvasH');
    const cvV = document.getElementById('canvasV');
    const ctxH = cvH.getContext('2d');
    const ctxV = cvV.getContext('2d');
    
    const inputs = {
        rw: document.getElementById('ratioW'),
        rh: document.getElementById('ratioH'),
        res: document.getElementById('baseRes'),
        title: document.getElementById('songTitle'),
        artist: document.getElementById('artistName'),
        lyrics: document.getElementById('lyricsText'),
        scale: document.getElementById('scaleFactor'),
        curr: document.getElementById('timeCurr'),
        left: document.getElementById('timeLeft'),
        prog: document.getElementById('progressVal'),
        overlay: document.getElementById('overlayVal')
    };
    
    // æ•°å€¼æ˜¾ç¤ºæ ‡ç­¾
    const scaleValueText = document.getElementById('scaleValueText');

    let backgroundImg = null;

    updateDimensions();

    document.querySelectorAll('input, textarea').forEach(el => {
        if(el.type === 'file') return;
        el.addEventListener('input', (e) => {
            // è¿™é‡Œå¤„ç†æ•°å€¼æ›´æ–°æ˜¾ç¤º
            if (el.id === 'scaleFactor') {
                updateScaleText(el.value);
            }

            if(['ratioW', 'ratioH', 'baseRes'].includes(el.id)) {
                updateDimensions();
            } else {
                drawAll();
            }
        });
    });

    // è¾…åŠ©å‡½æ•°ï¼šæ›´æ–°æ•°å€¼æ˜¾ç¤ºæ–‡æ¡ˆ
    function updateScaleText(val) {
        const floatVal = parseFloat(val);
        if (floatVal === 1.0) {
            scaleValueText.textContent = "1.0 (é»˜è®¤)";
            scaleValueText.className = "value-default";
        } else {
            scaleValueText.textContent = floatVal.toFixed(1); // ä¿ç•™ä¸€ä½å°æ•°
            scaleValueText.className = "value-display";
        }
    }

    document.getElementById('bgInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = function(event) {
            const img = new Image();
            img.onload = function() {
                backgroundImg = img;
                drawAll();
            }
            img.src = event.target.result;
        }
        reader.readAsDataURL(file);
    });

    function updateDimensions() {
        const rw = parseFloat(inputs.rw.value) || 16;
        const rh = parseFloat(inputs.rh.value) || 9;
        const base = parseFloat(inputs.res.value) || 1080;

        cvH.height = base;
        cvH.width = base * (rw / rh);

        cvV.width = base;
        cvV.height = base * (rw / rh);

        drawAll();
    }

    function drawAll() {
        draw(cvH, ctxH);
        draw(cvV, ctxV);
    }

    function draw(canvas, ctx) {
        const w = canvas.width;
        const h = canvas.height;
        const scaleUser = parseFloat(inputs.scale.value);
        
        const minSide = Math.min(w, h);
        const ratio = (minSide / 1080) * scaleUser; 

        ctx.clearRect(0, 0, w, h);
        if (backgroundImg) {
            const imgRatio = backgroundImg.width / backgroundImg.height;
            const canvasRatio = w / h;
            let dw, dh, dx, dy;
            if (canvasRatio > imgRatio) {
                dw = w; dh = w / imgRatio; dx = 0; dy = (h - dh) / 2;
            } else {
                dh = h; dw = h * imgRatio; dy = 0; dx = (w - dw) / 2;
            }
            ctx.drawImage(backgroundImg, dx, dy, dw, dh);
        } else {
            ctx.fillStyle = "#ffffff";
            ctx.fillRect(0, 0, w, h);
        }

        const overlay = parseFloat(inputs.overlay.value);
        if (overlay > 0) {
            ctx.fillStyle = `rgba(0,0,0,${overlay})`;
            ctx.fillRect(0, 0, w, h);
        }

        const isDark = (backgroundImg || overlay > 0.3);
        const cMain = isDark ? "#ffffff" : "#333333";
        const cSub = isDark ? "#cccccc" : "#888888";
        const cAccent = "#007aff";
        const cRed = "#ff3b30";

        const headerY = h * 0.15;
        const controlsY = h - (h * 0.12);
        const progressY = controlsY - (100 * ratio);

        ctx.textAlign = 'center';
        
        // Header
        ctx.fillStyle = cMain;
        ctx.textBaseline = 'bottom';
        ctx.font = `bold ${50 * ratio}px -apple-system, BlinkMacSystemFont, sans-serif`;
        ctx.fillText(inputs.title.value, w / 2, headerY);

        ctx.fillStyle = cSub;
        ctx.textBaseline = 'top';
        ctx.font = `${30 * ratio}px -apple-system, BlinkMacSystemFont, sans-serif`;
        ctx.fillText(inputs.artist.value, w / 2, headerY + (10 * ratio));

        // UI
        const barWidth = w * 0.8; 
        const barHeight = 12 * ratio;
        const barX = (w - barWidth) / 2;

        ctx.fillStyle = isDark ? "rgba(255,255,255,0.2)" : "#e5e5e5";
        ctx.beginPath();
        ctx.roundRect(barX, progressY, barWidth, barHeight, barHeight/2);
        ctx.fill();

        const prog = parseFloat(inputs.prog.value);
        ctx.fillStyle = cAccent;
        ctx.beginPath();
        ctx.roundRect(barX, progressY, barWidth * prog, barHeight, barHeight/2);
        ctx.fill();

        ctx.fillStyle = cSub;
        ctx.font = `${24 * ratio}px sans-serif`;
        ctx.textBaseline = "middle";
        ctx.textAlign = "right";
        ctx.fillText(inputs.curr.value, barX - (20 * ratio), progressY + barHeight/2);
        ctx.textAlign = "left";
        ctx.fillText(inputs.left.value, barX + barWidth + (20 * ratio), progressY + barHeight/2);

        const iconSize = 2.5 * ratio;
        const maxDist = (w / 2) - (40 * ratio);
        const distSide = Math.min(450 * ratio, maxDist);
        const distMid = Math.min(200 * ratio, maxDist * 0.5);

        drawIcon(ctx, ICONS.pause, w/2, controlsY, iconSize + 0.5, cMain);
        drawIcon(ctx, ICONS.arrowLeft, w/2 - distMid, controlsY, iconSize, cMain);
        ctx.fillStyle = cMain;
        ctx.font = `bold ${14 * ratio}px sans-serif`;
        ctx.textAlign = "center";
        ctx.fillText("15", w/2 - distMid, controlsY + (40 * ratio));
        drawIcon(ctx, ICONS.arrowRight, w/2 + distMid, controlsY, iconSize, cMain);
        ctx.fillText("15", w/2 + distMid, controlsY + (40 * ratio));
        drawIcon(ctx, ICONS.volume, w/2 - distSide, controlsY, iconSize, cRed);
        drawIcon(ctx, ICONS.trash, w/2 + distSide, controlsY, iconSize, cRed);

        // Lyrics
        const areaTop = headerY + (50 * ratio);
        const areaBottom = progressY - (50 * ratio);
        const areaCenter = areaTop + (areaBottom - areaTop) / 2;

        ctx.fillStyle = cMain;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        
        const fontSize = 120 * ratio; 
        ctx.font = `${fontSize}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`;

        const lines = inputs.lyrics.value.split('\n');
        const lineHeight = fontSize * 1.3;
        
        const textStartY = areaCenter - ((lines.length - 1) * lineHeight) / 2;
        
        lines.forEach((line, i) => {
            ctx.fillText(line, w / 2, textStartY + i * lineHeight);
        });
    }

    function drawIcon(ctx, path, x, y, scale, color) {
        ctx.save();
        ctx.translate(x, y);
        ctx.scale(scale, scale);
        ctx.translate(-12, -12); 
        const p = new Path2D(path);
        ctx.fillStyle = color;
        ctx.fill(p);
        ctx.restore();
    }

    function downloadImage(type) {
        const canvas = type === 'h' ? cvH : cvV;
        const link = document.createElement('a');
        link.download = `cover_${type}_${canvas.width}x${canvas.height}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
    }
</script>

</body>
</html>