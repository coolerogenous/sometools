<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒå±è‡ªé€‚åº”å°é¢ (è‡ªå®šä¹‰é…è‰²ç‰ˆ)</title>
    <style>
        body {
            margin: 0;
            background-color: #121212;
            color: #eee;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* --- å·¦ä¾§æ§åˆ¶æ  --- */
        .sidebar {
            width: 350px;
            background-color: #1e1e1e;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            border-right: 1px solid #333;
            overflow-y: auto;
            flex-shrink: 0;
        }

        .sidebar::-webkit-scrollbar { width: 5px; }
        .sidebar::-webkit-scrollbar-thumb { background: #444; border-radius: 2px; }

        h2 { margin: 12px 0 6px 0; font-size: 13px; color: #888; letter-spacing: 1px; font-weight: 600; text-transform: uppercase; border-bottom: 1px solid #333; padding-bottom: 4px; }
        
        .control-group { display: flex; flex-direction: column; gap: 5px; }
        .row { display: flex; gap: 8px; align-items: center; }
        
        label { font-size: 12px; color: #aaa; display: flex; justify-content: space-between; align-items: center; }
        
        .value-display { color: #007aff; font-weight: bold; font-family: monospace; }
        .value-default { color: #34c759; font-weight: bold; }

        input[type="text"], input[type="number"], textarea, button, input[type="range"] {
            background: #2c2c2c;
            border: 1px solid #3d3d3d;
            color: white;
            padding: 8px;
            border-radius: 4px;
            font-size: 13px;
            box-sizing: border-box;
            width: 100%;
        }

        /* é¢œè‰²é€‰æ‹©å™¨æ ·å¼ä¼˜åŒ– */
        input[type="color"] {
            -webkit-appearance: none;
            border: none;
            width: 100%;
            height: 30px;
            padding: 0;
            background: none;
            cursor: pointer;
        }
        input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
        input[type="color"]::-webkit-color-swatch { border: 1px solid #555; border-radius: 4px; }

        input:focus, textarea:focus { border-color: #007aff; outline: none; }
        textarea { resize: vertical; min-height: 60px; font-family: inherit; }

        .ratio-input { text-align: center; font-weight: bold; font-size: 16px; color: #007aff; }
        .ratio-divider { color: #888; font-weight: bold; }

        .btn-save {
            background-color: #34c759; border: none; font-weight: bold; 
            padding: 10px; cursor: pointer; margin-top: 5px;
        }
        .btn-save:hover { background-color: #2da84a; }

        /* --- å³ä¾§é¢„è§ˆåŒº --- */
        .preview-area {
            flex-grow: 1;
            background-color: #000;
            display: flex;
            gap: 20px;
            padding: 40px;
            overflow: auto;
            justify-content: center;
            align-items: center;
            background-image: radial-gradient(#333 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .canvas-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .canvas-label {
            font-size: 12px; color: #666; background: #222; 
            padding: 4px 8px; border-radius: 4px; border: 1px solid #333;
        }

        canvas {
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            max-height: 80vh; 
            max-width: 45vw;
            background: #fff;
            object-fit: contain;
        }
    </style>
</head>
<body>

    <div class="sidebar">
        <h1 style="font-size: 16px; margin: 0 0 10px 0; color: #fff;">ğŸ¨ å…¨èƒ½å°é¢ç”Ÿæˆå™¨</h1>

        <h2>1. æ¯”ä¾‹è®¾ç½®</h2>
        <div class="control-group">
            <div class="row">
                <input type="number" id="ratioW" class="ratio-input" value="16">
                <span class="ratio-divider">:</span>
                <input type="number" id="ratioH" class="ratio-input" value="9">
            </div>
            <label style="margin-top:5px;">åŸºå‡†é«˜åº¦ (px)</label>
            <input type="number" id="baseRes" value="1080">
        </div>

        <h2>2. æ­Œæ›²ä¿¡æ¯</h2>
        <div class="control-group">
            <label>æ­Œå</label>
            <input type="text" id="songTitle" value="åäºŒæ¥¼">
        </div>
        <div class="control-group">
            <label>æ­Œæ‰‹</label>
            <input type="text" id="artistName" value="Sourvill">
        </div>

        <h2>3. æ­Œè¯å†…å®¹</h2>
        <div class="control-group">
            <label>æ­Œè¯æ–‡æœ¬</label>
            <textarea id="lyricsText">{\__/}
( â€¢ - â€¢)
/ã¤ ğŸ“
åäºŒæ¥¼</textarea>
        </div>
        <div class="row">
            <div class="control-group" style="flex:1">
                <label>å­—ä½“ç¼©æ”¾ <span id="scaleValueText" class="value-default">1.0</span></label>
                <input type="range" id="scaleFactor" min="0.5" max="2.0" step="0.1" value="1.0" list="scaleList">
                <datalist id="scaleList"><option value="1.0"></datalist>
            </div>
        </div>

        <h2>4. æ’­æ”¾å™¨çŠ¶æ€</h2>
        <div class="row">
            <div class="control-group" style="flex:1">
                <label>å½“å‰æ—¶é—´</label>
                <input type="text" id="timeCurr" value="3:00">
            </div>
            <div class="control-group" style="flex:1">
                <label>å‰©ä½™æ—¶é—´</label>
                <input type="text" id="timeLeft" value="-1:04">
            </div>
        </div>
        <div class="control-group">
            <label>è¿›åº¦ (0-1)</label>
            <input type="range" id="progressVal" min="0" max="1" step="0.01" value="0.72">
        </div>

        <h2>5. èƒŒæ™¯ä¸é®ç½©</h2>
        <div class="control-group">
            <label>ä¸Šä¼ èƒŒæ™¯å›¾</label>
            <input type="file" id="bgInput" accept="image/*">
        </div>
        <div class="control-group">
            <label>é®ç½©æµ“åº¦ (0-1)</label>
            <input type="range" id="overlayVal" min="0" max="0.9" step="0.05" value="0.1">
        </div>

        <h2>6. UI é…è‰²</h2>
        <div class="row">
            <div class="control-group" style="flex:1">
                <label>è¿›åº¦æ¡</label>
                <input type="color" id="colProg" value="#007aff">
            </div>
            <div class="control-group" style="flex:1">
                <label>è¿›åº¦åº•è‰²</label>
                <input type="color" id="colProgBg" value="#e5e5e5">
            </div>
        </div>
        <div class="row">
            <div class="control-group" style="flex:1">
                <label>ä¸»æŒ‰é’®(é»‘)</label>
                <input type="color" id="colBtnMain" value="#333333">
            </div>
            <div class="control-group" style="flex:1">
                <label>å‰¯æŒ‰é’®(çº¢)</label>
                <input type="color" id="colBtnSide" value="#ff3b30">
            </div>
        </div>

        <div class="row" style="margin-top: 15px;">
            <button class="btn-save" style="background:#007aff" onclick="downloadImage('h')">ğŸ’¾ ä¸‹æ¨ªå±</button>
            <button class="btn-save" onclick="downloadImage('v')">ğŸ’¾ ä¸‹ç«–å±</button>
        </div>
    </div>

    <div class="preview-area">
        <div class="canvas-group">
            <span class="canvas-label">æ¨ªå±</span>
            <canvas id="canvasH"></canvas>
        </div>
        <div class="canvas-group">
            <span class="canvas-label">ç«–å±</span>
            <canvas id="canvasV"></canvas>
        </div>
    </div>

<script>
    const ICONS = {
        play: "M8 5v14l11-7z", 
        pause: "M6 19h4V5H6v14zm8-14v14h4V5h-4z",
        arrowLeft: "M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z",
        arrowRight: "M4 18l8.5-6L4 6v12zm9-12v12l8.5-6L13 6z",
        volume: "M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z",
        trash: "M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"
    };

    const cvH = document.getElementById('canvasH');
    const cvV = document.getElementById('canvasV');
    const ctxH = cvH.getContext('2d');
    const ctxV = cvV.getContext('2d');
    
    // è¾“å…¥å…ƒç´ æ˜ å°„
    const inputs = {
        rw: document.getElementById('ratioW'),
        rh: document.getElementById('ratioH'),
        res: document.getElementById('baseRes'),
        title: document.getElementById('songTitle'),
        artist: document.getElementById('artistName'),
        lyrics: document.getElementById('lyricsText'),
        scale: document.getElementById('scaleFactor'),
        curr: document.getElementById('timeCurr'),
        left: document.getElementById('timeLeft'),
        prog: document.getElementById('progressVal'),
        overlay: document.getElementById('overlayVal'),
        // é¢œè‰²è¾“å…¥
        cProg: document.getElementById('colProg'),
        cProgBg: document.getElementById('colProgBg'),
        cBtnMain: document.getElementById('colBtnMain'),
        cBtnSide: document.getElementById('colBtnSide')
    };
    
    const scaleValueText = document.getElementById('scaleValueText');
    let backgroundImg = null;

    updateDimensions();

    // ç»‘å®šæ‰€æœ‰äº‹ä»¶
    document.querySelectorAll('input, textarea').forEach(el => {
        if(el.type === 'file') return;
        el.addEventListener('input', (e) => {
            if (el.id === 'scaleFactor') updateScaleText(el.value);
            
            // é¢œè‰²æ›´æ”¹æ—¶å¦‚æœç”¨æˆ·é€‰æ‹©äº†æ·±è‰²èƒŒæ™¯ï¼Œå¯èƒ½ä¼šæƒ³è°ƒæ•´æ–‡å­—é¢œè‰²
            // è¿™é‡Œä¸ºäº†ç®€å•ï¼Œæ–‡å­—é¢œè‰²ä¾ç„¶è‡ªåŠ¨é€‚é…èƒŒæ™¯æ·±æµ…ï¼Œä½†UIé¢œè‰²å®Œå…¨å¬ç”¨æˆ·çš„

            if(['ratioW', 'ratioH', 'baseRes'].includes(el.id)) {
                updateDimensions();
            } else {
                drawAll();
            }
        });
    });

    function updateScaleText(val) {
        const floatVal = parseFloat(val);
        if (floatVal === 1.0) {
            scaleValueText.textContent = "1.0";
            scaleValueText.className = "value-default";
        } else {
            scaleValueText.textContent = floatVal.toFixed(1);
            scaleValueText.className = "value-display";
        }
    }

    document.getElementById('bgInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = function(event) {
            const img = new Image();
            img.onload = function() {
                backgroundImg = img;
                // å½“ä¸Šä¼ å›¾ç‰‡æ—¶ï¼Œè‡ªåŠ¨æŠŠUIé¢œè‰²åˆ‡æ¢æˆç™½è‰²/æµ…è‰²æ¨¡å¼ï¼Œæ–¹ä¾¿ç”¨æˆ·
                // ä½†ä¸ºäº†ä¸æ‰“æ‰°ç”¨æˆ·è‡ªå®šä¹‰ï¼Œè¿™é‡Œä»…åšä¸€æ¬¡æ€§å»ºè®®ï¼Œæˆ–è€…ä¸åš
                // æš‚æ—¶ä¿æŒç”¨æˆ·å½“å‰çš„é¢œè‰²è®¾ç½®
                drawAll();
            }
            img.src = event.target.result;
        }
        reader.readAsDataURL(file);
    });

    function updateDimensions() {
        const rw = parseFloat(inputs.rw.value) || 16;
        const rh = parseFloat(inputs.rh.value) || 9;
        const base = parseFloat(inputs.res.value) || 1080;

        cvH.height = base;
        cvH.width = base * (rw / rh);

        cvV.width = base;
        cvV.height = base * (rw / rh);

        drawAll();
    }

    function drawAll() {
        draw(cvH, ctxH);
        draw(cvV, ctxV);
    }

    function draw(canvas, ctx) {
        const w = canvas.width;
        const h = canvas.height;
        const scaleUser = parseFloat(inputs.scale.value);
        const minSide = Math.min(w, h);
        const ratio = (minSide / 1080) * scaleUser; 

        // 1. ç»˜åˆ¶èƒŒæ™¯
        ctx.clearRect(0, 0, w, h);
        if (backgroundImg) {
            const imgRatio = backgroundImg.width / backgroundImg.height;
            const canvasRatio = w / h;
            let dw, dh, dx, dy;
            if (canvasRatio > imgRatio) {
                dw = w; dh = w / imgRatio; dx = 0; dy = (h - dh) / 2;
            } else {
                dh = h; dw = h * imgRatio; dy = 0; dx = (w - dw) / 2;
            }
            ctx.drawImage(backgroundImg, dx, dy, dw, dh);
        } else {
            ctx.fillStyle = "#ffffff";
            ctx.fillRect(0, 0, w, h);
        }

        const overlay = parseFloat(inputs.overlay.value);
        if (overlay > 0) {
            ctx.fillStyle = `rgba(0,0,0,${overlay})`;
            ctx.fillRect(0, 0, w, h);
        }

        // 2. é¢œè‰²å®šä¹‰ (æ–‡å­—è‡ªåŠ¨ï¼ŒUIæ‰‹åŠ¨)
        const isDark = (backgroundImg || overlay > 0.3);
        const cTextMain = isDark ? "#ffffff" : "#333333";
        const cTextSub = isDark ? "#cccccc" : "#888888";
        
        // è·å–ç”¨æˆ·è‡ªå®šä¹‰é¢œè‰²
        const cProg = inputs.cProg.value;
        const cProgBg = inputs.cProgBg.value;
        const cBtnMain = inputs.cBtnMain.value;
        const cBtnSide = inputs.cBtnSide.value;

        // 3. å¸ƒå±€ç»˜åˆ¶
        const headerY = h * 0.15;
        const controlsY = h - (h * 0.12);
        const progressY = controlsY - (100 * ratio);

        ctx.textAlign = 'center';
        
        // Header
        ctx.fillStyle = cTextMain;
        ctx.textBaseline = 'bottom';
        ctx.font = `bold ${50 * ratio}px -apple-system, BlinkMacSystemFont, sans-serif`;
        ctx.fillText(inputs.title.value, w / 2, headerY);

        ctx.fillStyle = cTextSub;
        ctx.textBaseline = 'top';
        ctx.font = `${30 * ratio}px -apple-system, BlinkMacSystemFont, sans-serif`;
        ctx.fillText(inputs.artist.value, w / 2, headerY + (10 * ratio));

        // UI Components
        const barWidth = w * 0.8; 
        const barHeight = 12 * ratio;
        const barX = (w - barWidth) / 2;

        // è¿›åº¦æ¡åº•è‰²
        ctx.fillStyle = cProgBg;
        ctx.beginPath();
        ctx.roundRect(barX, progressY, barWidth, barHeight, barHeight/2);
        ctx.fill();

        // è¿›åº¦æ¡å¡«å……è‰²
        const prog = parseFloat(inputs.prog.value);
        ctx.fillStyle = cProg;
        ctx.beginPath();
        ctx.roundRect(barX, progressY, barWidth * prog, barHeight, barHeight/2);
        ctx.fill();

        // æ—¶é—´
        ctx.fillStyle = cTextSub;
        ctx.font = `${24 * ratio}px sans-serif`;
        ctx.textBaseline = "middle";
        ctx.textAlign = "right";
        ctx.fillText(inputs.curr.value, barX - (20 * ratio), progressY + barHeight/2);
        ctx.textAlign = "left";
        ctx.fillText(inputs.left.value, barX + barWidth + (20 * ratio), progressY + barHeight/2);

        // æŒ‰é’®
        const iconSize = 2.5 * ratio;
        const maxDist = (w / 2) - (40 * ratio);
        const distSide = Math.min(450 * ratio, maxDist);
        const distMid = Math.min(200 * ratio, maxDist * 0.5);

        // ä½¿ç”¨è‡ªå®šä¹‰é¢œè‰²ç»˜åˆ¶å›¾æ ‡
        drawIcon(ctx, ICONS.pause, w/2, controlsY, iconSize + 0.5, cBtnMain);
        drawIcon(ctx, ICONS.arrowLeft, w/2 - distMid, controlsY, iconSize, cBtnMain);
        
        ctx.fillStyle = cBtnMain; // 15ç§’æ–‡å­—è·Ÿéšä¸»æŒ‰é’®é¢œè‰²
        ctx.font = `bold ${14 * ratio}px sans-serif`;
        ctx.textAlign = "center";
        ctx.fillText("15", w/2 - distMid, controlsY + (40 * ratio));
        
        drawIcon(ctx, ICONS.arrowRight, w/2 + distMid, controlsY, iconSize, cBtnMain);
        ctx.fillText("15", w/2 + distMid, controlsY + (40 * ratio));
        
        drawIcon(ctx, ICONS.volume, w/2 - distSide, controlsY, iconSize, cBtnSide);
        drawIcon(ctx, ICONS.trash, w/2 + distSide, controlsY, iconSize, cBtnSide);

        // æ­Œè¯
        const areaTop = headerY + (50 * ratio);
        const areaBottom = progressY - (50 * ratio);
        const areaCenter = areaTop + (areaBottom - areaTop) / 2;

        ctx.fillStyle = cTextMain;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        
        const fontSize = 120 * ratio; 
        ctx.font = `${fontSize}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`;

        const lines = inputs.lyrics.value.split('\n');
        const lineHeight = fontSize * 1.3;
        const textStartY = areaCenter - ((lines.length - 1) * lineHeight) / 2;
        
        lines.forEach((line, i) => {
            ctx.fillText(line, w / 2, textStartY + i * lineHeight);
        });
    }

    function drawIcon(ctx, path, x, y, scale, color) {
        ctx.save();
        ctx.translate(x, y);
        ctx.scale(scale, scale);
        ctx.translate(-12, -12); 
        const p = new Path2D(path);
        ctx.fillStyle = color;
        ctx.fill(p);
        ctx.restore();
    }

    function downloadImage(type) {
        const canvas = type === 'h' ? cvH : cvV;
        const link = document.createElement('a');
        link.download = `cover_${type}_${canvas.width}x${canvas.height}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
    }
</script>

</body>
</html>